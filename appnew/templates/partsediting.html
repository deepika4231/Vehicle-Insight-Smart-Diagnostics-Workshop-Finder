{% extends 'adminheader.html' %}

{% block content %}
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #d9afd9 0%, #97d9e1 100%);
    min-height: 100vh;
  }
  .center-outer {
    min-height: 80vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .container {
    background: rgba(255, 255, 255, 0.85); /* Light background for contrast */
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-radius: 20px;
    box-shadow: 0 8px 32px rgba(31, 38, 135, 0.3);
    padding: 40px 30px;
    max-width: 550px;
    width: 100%;
    animation: fadeInUp 0.8s ease forwards;
    color: #222222; /* Dark text color */
  }
  @keyframes fadeInUp {
    0% { opacity: 0; transform: translateY(40px);}
    100% { opacity: 1; transform: translateY(0);}
  }
  h1 {
    text-align: center;
    color: #494747;
    font-size: 2rem;
    margin-bottom: 30px;
    text-shadow: 1px 2px 4px rgba(0,0,0,0.25);
  }
  a.back-btn {
    display: inline-block;
    text-decoration: none;
    background-color: rgba(0, 0, 0, 0.3);
    color: #ffffff;
    padding: 10px 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    font-weight: 500;
    transition: background-color 0.3s ease;
  }
  a.back-btn:hover {
    background-color: rgba(0, 0, 0, 0.5);
  }
  form {
    display: flex;
    flex-direction: column;
  }
  label {
    display: block;
    margin-bottom: 6px;
    color: #222222; /* Dark label color for visibility */
    font-weight: 600;
    font-size: 15px;
  }
  input, select, textarea {
    width: 100%;
    padding: 12px;
    border: none;
    border-radius: 10px;
    font-size: 14px;
    outline: none;
    background: rgba(255, 255, 255, 0.95);
    color: #333333;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    transition: all 0.3s ease;
  }
  input:focus, select:focus, textarea:focus {
    background-color: #ffffff;
    box-shadow: 0 0 0 3px rgba(0,123,255,0.2);
  }
  button {
    background-color: #6a11cb;
    background-image: linear-gradient(315deg, #6a11cb 0%, #2575fc 74%);
    color: white;
    padding: 14px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    margin-top: 10px;
    transition: transform 0.2s ease, background 0.3s ease;
  }
  button:hover {
    transform: translateY(-2px);
    background-image: linear-gradient(315deg, #5c0eb8 0%, #1a5fd3 74%);
  }
  @media (max-width: 600px) {
    .container {
      padding: 30px 10px;
    }
    h1 {
      font-size: 1.5rem;
      font-weight: 500;
    }
    label {
      font-size: 14px;
    }
  }
</style>

<div class="center-outer">
  <div class="container">
    <a href="../../adminhomepage" class="back-btn">‚Üê Back to Admin Homepage</a>
    <h1>üöó Edit Spare Part Details</h1>
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      
      <label for="{{ form.part_name.id_for_label }}">Part Name</label>
      {{ form.part_name }}

      <label for="{{ form.part_number.id_for_label }}">Part Number</label>
      {{ form.part_number }}

      <label for="{{ form.company.id_for_label }}">Manufacturer (Company)</label>
      {{ form.company }}

      <label for="{{ form.vehicle_model.id_for_label }}">Vehicle Model</label>
      {{ form.vehicle_model }}

      <label for="{{ form.part_year.id_for_label }}">Part Year</label>
      {{ form.part_year }}

      <label for="{{ form.part_price.id_for_label }}">Price</label>
      {{ form.part_price }}

      <label for="{{ form.stock.id_for_label }}">Stock</label>
      {{ form.stock }}

      <label for="{{ form.part_image.id_for_label }}">Image Upload</label>
      {{ form.part_image }}

      <button type="submit">Save Changes</button>
    </form>
  </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const validators = [];

  function handleValidation(input, pattern, validMsg, invalidMsg) {
    const feedback = document.createElement('small');
    feedback.style.display = 'block';
    input.parentNode.appendChild(feedback);

    function validate() {
      const value = input.value.trim();
      if (!value) {
        feedback.textContent = '‚ùå This field is required';
        feedback.style.color = 'red';
        return false;
      } else if (!pattern.test(value)) {
        feedback.textContent = '‚ùå ' + invalidMsg;
        feedback.style.color = 'red';
        return false;
      } else {
        feedback.textContent = '‚úÖ ' + validMsg;
        feedback.style.color = 'green';
        return true;
      }
    }

    input.addEventListener('input', validate);
    validators.push(validate);
  }

  // Basic text field validations
  handleValidation(
    document.querySelector('input[name="part_name"]'),
    /^[A-Za-z0-9\s-]{2,50}$/,
    'Valid part name',
    'Enter a valid part name'
  );

  handleValidation(
    document.querySelector('input[name="part_number"]'),
    /^[A-Za-z0-9-]{2,20}$/,
    'Valid part number',
    'Enter a valid part number'
  );

  handleValidation(
    document.querySelector('input[name="company"]'),
    /^[A-Za-z0-9\s]{2,50}$/,
    'Valid company name',
    'Enter a valid manufacturer name'
  );

  handleValidation(
    document.querySelector('input[name="vehicle_model"]'),
    /^[A-Za-z0-9\s]{2,50}$/,
    'Valid model',
    'Enter a valid vehicle model'
  );

  // Number field validations
  handleValidation(
    document.querySelector('input[name="part_year"]'),
    /^(19|20)\d{2}$/,
    'Valid year',
    'Year must be between 1990‚Äì2025'
  );

  handleValidation(
    document.querySelector('input[name="part_price"]'),
    /^\d+(\.\d{1,2})?$/,
    'Valid price',
    'Enter a valid price (e.g. 250.00)'
  );

  handleValidation(
    document.querySelector('input[name="stock"]'),
    /^\d+$/,
    'Valid stock quantity',
    'Enter a valid stock number'
  );
  // Image upload validation
  const imageInput = document.querySelector('input[name="part_image"]');
  const imageFeedback = document.createElement('small');
  imageFeedback.style.display = 'block';
  imageInput.parentNode.appendChild(imageFeedback);

  imageInput.addEventListener('change', function () {
    const file = this.files[0];
    if (file) {
      const validTypes = ['image/jpeg', 'image/png', 'image/gif'];
      if (validTypes.includes(file.type)) {
        imageFeedback.textContent = '‚úÖ Valid image file';
        imageFeedback.style.color = 'green';
      } else {
        imageFeedback.textContent = '‚ùå Invalid image type. Please upload a JPEG, PNG, or GIF.';
        imageFeedback.style.color = 'red';
      }
    } else {
      imageFeedback.textContent = '‚ùå No file selected';
      imageFeedback.style.color = 'red';
    }
  });

  const form = document.querySelector('form');
  if (form) {
    form.addEventListener('submit', function (e) {
      let isValid = true;
      validators.forEach(validateFn => {
        if (!validateFn()) isValid = false;
      });
      if (!isValid) {
        e.preventDefault();
        alert("‚ùå Please correct the highlighted errors before submitting.");
      }
    });
  }
});

</script>
{% endblock %}
