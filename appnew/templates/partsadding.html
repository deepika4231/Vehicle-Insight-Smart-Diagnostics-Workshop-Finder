{% extends "adminheader.html" %}
{% block content %}
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: url('https://images.unsplash.com/photo-1605542140893-26d66aa44dc4?auto=format&fit=crop&w=1950&q=80') no-repeat center center fixed;
    background-size: cover;
    margin: 0;
    padding: 0;
  }
  .center-outer {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px 0;
  }
  .form-container {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(12px);
    border-radius: 20px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
    padding: 40px 30px;
    max-width: 500px;
    width: 100%;
    animation: slideIn 0.8s ease-out;
    color: #111111;
  }
  h1 {
    text-align: center;
    font-size: 2.2rem;
    font-weight: 600;
    margin-bottom: 25px;
    color: #111111;
  }
  form {
    display: flex;
    flex-direction: column;
  }
  label {
    margin: 12px 0 6px;
    font-weight: 600;
    color: #111111;
  }
  input, select {
    padding: 12px;
    border-radius: 8px;
    border: none;
    font-size: 15px;
    background: #ffffff;
    color: #000;
    margin-bottom: 5px;
    box-shadow: 0 0 3px rgba(0,0,0,0.1);
  }
  input:focus, select:focus {
    outline: none;
    border: 2px solid #4facfe;
  }
  ::placeholder {
    color: rgba(0, 0, 0, 0.5);
    font-style: italic;
  }
  input[type="file"] {
    padding: 10px;
    background-color: #ffffff;
  }
  small {
    font-size: 0.85em;
    margin-bottom: 8px;
  }
  button {
    margin-top: 25px;
    padding: 14px;
    background: linear-gradient(45deg, #4facfe, #00f2fe);
    color: white;
    border: none;
    font-weight: 600;
    border-radius: 10px;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
  }
  button:hover {
    transform: scale(1.05);
    background: linear-gradient(45deg, #00f2fe, #4facfe);
  }
  @keyframes slideIn {
    from { opacity: 0; transform: translateY(40px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>

<div class="center-outer">
  <div class="form-container">
    <form method="POST" enctype="multipart/form-data">
      <h1>üöó Add New Part</h1>
      {% csrf_token %}

      <label for="partname">Part Name</label>
      <input type="text" id="partname" name="part_name" placeholder="Hint:Brake Pad" required>

      <label for="partnumber">Part Number</label>
      <input type="text" id="partnumber" name="part_number" placeholder="Hint:BP-34982" required>

      <label for="company">Manufacturer (Company)</label>
      <input type="text" id="company" name="company" placeholder="Hint:Bosch" required>

      <label for="vehiclemodel">Vehicle Model</label>
      <input type="text" id="vehiclemodel" name="vehicle_model" placeholder="Hint:Honda Civic" required>

      <label for="manufacturingyear">Part Year</label>
      <input type="number" id="manufacturingyear" name="part_year" min="1990" max="2025" placeholder="Hint:2022" required>

      <label for="price">Price ($)</label>
      <input type="number" id="price" name="part_price" step="0.01" placeholder="Hint:250.00" required>

      <label for="stock">Stock</label>
      <input type="number" id="stock" name="stock" step="1" min="0" placeholder="Hint:15" required>

      <label for="image">Upload Image</label>
      <input type="file" id="image" name="part_image" accept="image/*" required>

      <button type="submit">üì§ Upload Part</button>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const validators = [];

  function handleValidation(input, pattern, validMsg, invalidMsg) {
    const feedback = document.createElement('small');
    feedback.style.display = 'block';
    feedback.style.marginTop = '2px';
    input.insertAdjacentElement('afterend', feedback);

    function validate() {
      const value = input.value.trim();
      if (!value) {
        feedback.textContent = '‚ùå This field is required';
        feedback.style.color = 'red';
        return false;
      } else if (!pattern.test(value)) {
        feedback.textContent = '‚ùå ' + invalidMsg;
        feedback.style.color = 'red';
        return false;
      } else {
        feedback.textContent = '‚úÖ ' + validMsg;
        feedback.style.color = 'green';
        return true;
      }
    }

    input.addEventListener('input', validate);
    validators.push(validate);
  }

  // Apply validation rules
  handleValidation(
    document.querySelector('input[name="part_name"]'),
    /^[A-Za-z0-9\s-]{2,50}$/,
    'Valid part name',
    'Enter a valid part name'
  );

  handleValidation(
    document.querySelector('input[name="part_number"]'),
    /^[A-Za-z0-9-]{2,20}$/,
    'Valid part number',
    'Enter a valid part number'
  );

  handleValidation(
    document.querySelector('input[name="company"]'),
    /^[A-Za-z0-9\s]{2,50}$/,
    'Valid company name',
    'Enter a valid manufacturer name'
  );

  handleValidation(
    document.querySelector('input[name="vehicle_model"]'),
    /^[A-Za-z0-9\s]{2,50}$/,
    'Valid model',
    'Enter a valid vehicle model'
  );

  handleValidation(
    document.querySelector('input[name="part_year"]'),
    /^(19|20)\d{2}$/,
    'Valid year',
    'Year must be between 1990‚Äì2025'
  );

  handleValidation(
    document.querySelector('input[name="part_price"]'),
    /^\d+(\.\d{1,2})?$/,
    'Valid price',
    'Enter a valid price (e.g. 250.00)'
  );

  handleValidation(
    document.querySelector('input[name="stock"]'),
    /^\d+$/,
    'Valid stock quantity',
    'Enter a valid stock number'
  );

  // Image file type validation
  const imageInput = document.querySelector('input[name="part_image"]');
  const imageFeedback = document.createElement('small');
  imageFeedback.style.display = 'block';
  imageFeedback.style.marginTop = '2px';
  imageInput.insertAdjacentElement('afterend', imageFeedback);

  imageInput.addEventListener('change', function () {
    const file = this.files[0];
    if (file) {
      const validTypes = ['image/jpeg', 'image/png', 'image/gif'];
      if (validTypes.includes(file.type)) {
        imageFeedback.textContent = '‚úÖ Valid image file';
        imageFeedback.style.color = 'green';
      } else {
        imageFeedback.textContent = '‚ùå Invalid image type. Please upload JPEG, PNG, or GIF.';
        imageFeedback.style.color = 'red';
      }
    } else {
      imageFeedback.textContent = '‚ùå No file selected';
      imageFeedback.style.color = 'red';
    }
  });

  // Final form check before submit
  const form = document.querySelector('form');
  if (form) {
    form.addEventListener('submit', function (e) {
      let isValid = true;
      validators.forEach(validateFn => {
        if (!validateFn()) isValid = false;
      });

      const imageFile = imageInput.files[0];
      if (!imageFile || !['image/jpeg', 'image/png', 'image/gif'].includes(imageFile.type)) {
        imageFeedback.textContent = '‚ùå Invalid or missing image file.';
        imageFeedback.style.color = 'red';
        isValid = false;
      }

      if (!isValid) {
        e.preventDefault();
        alert("‚ùå Please fix the highlighted errors before submitting.");
      }
    });
  }
});
</script>
{% endblock %}
